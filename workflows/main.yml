name: Build and Deploy

on:
  push:
    branches:
      - main
      - dev

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Install dependencies
        run: npm install

      - name: Build
        run: npm run build

  deploy:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Azure CLI
        uses: azure/login@v1
        with:
          creds: ${{ secrets.{

  "clientId": "717f47e0-ae85-4126-ba09-f89715ce00e2",

  "clientSecret": "J4g8Q~99jMKO9KB5QINkwFTiJncxYYfU_TDj6akE",

  "subscriptionId": "e0b9cada-61bc-4b5a-bd7a-52c606726b3b",

  "tenantId": "5ca2bc70-353c-4d1f-b7d7-7f2b2259df68",

  "activeDirectoryEndpointUrl": "https://login.microsoftonline.com",

  "resourceManagerEndpointUrl": "https://management.azure.com/",

  "activeDirectoryGraphResourceId": "https://graph.windows.net/",

  "sqlManagementEndpointUrl": "https://management.core.windows.net:8443/",

  "galleryEndpointUrl": "https://gallery.azure.com/",

  "managementEndpointUrl": "https://management.core.windows.net/"

}

 }}

      - name: Create resource group
        run: az group create --name my-resource-group --location "West Europe"

      - name: Deploy to Azure
        run: |
          az deployment group create --resource-group my-resource-group --template-file main.bicep --parameters-file parameters.json

env:
  MYSECRET: ${{ secrets.MYSECRET }}
